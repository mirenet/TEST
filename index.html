<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Floating YouTube Bubble</title>
<style>
body{
    margin:0;
    background:#111;
    font-family:Arial;
    overflow:hidden;
}

/* Controls */
#controls-bar{
    position:fixed;
    bottom:20px;
    width:100%;
    display:flex;
    justify-content:center;
    align-items:center;
    gap:25px;
    z-index:10000;
}

#play-btn{
    width:70px;
    height:70px;
    border-radius:50%;
    background:#6b8e23;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:28px;
    color:black;
    font-weight:bold;
    touch-action:none;
}

.ctrl-btn{
    font-size:26px;
    color:white;
}

/* Floating player */
#floating-player{
    position:fixed;
    width:260px;
    height:150px;
    background:black;
    border-radius:18px;
    overflow:hidden;
    box-shadow:0 15px 40px rgba(0,0,0,0.6);
    transition:transform 0.3s ease,bottom 0.3s ease,left 0.3s ease;
    z-index:9999;
    display:flex;
    flex-direction:column;
}

/* Drag handle */
#drag-handle{
    width:100%;
    height:25px;
    background:rgba(0,0,0,0.4);
    cursor:grab;
}

/* Player inside box */
#player{
    flex:1;
}
</style>
</head>
<body>

<div id="floating-player" style="display:none">
    <div id="drag-handle"></div>
    <div id="player"></div>
</div>

<div id="controls-bar">
    <div class="ctrl-btn" id="stop-btn">■</div>
    <div id="play-btn">▶</div>
    <div class="ctrl-btn" id="next-btn">⏭</div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
let player;
let floating = document.getElementById("floating-player");
let playBtn = document.getElementById("play-btn");
let startY, startX, swipeStartTime;
let isDragging = false;
let offsetX, offsetY;

/* Load saved position */
let savedPos = JSON.parse(localStorage.getItem("playerPos")) || {left:null, bottom:null};

/* YouTube API */
function onYouTubeIframeAPIReady(){
    player = new YT.Player('player',{
        videoId:"dQw4w9WgXcQ",
        playerVars:{
            autoplay:0,
            controls:1,
            playsinline:1,
            rel:0
        }
    });
}

/* Swipe up to expand */
playBtn.addEventListener("pointerdown", e=>{
    startY = e.clientY;
    startX = e.clientX;
    swipeStartTime = Date.now();
});

playBtn.addEventListener("pointerup", e=>{
    let diff = startY - e.clientY;
    if(diff > 50){ // swipe up
        showFloating();
        player.playVideo();
    } else {
        togglePlay();
    }
});

/* Show floating player near button */
function showFloating(){
    floating.style.display="flex";
    if(savedPos.left !== null){
        floating.style.left = savedPos.left + "px";
        floating.style.bottom = savedPos.bottom + "px";
    } else {
        // default bottom center
        floating.style.left = (window.innerWidth/2 - floating.offsetWidth/2) + "px";
        floating.style.bottom = "90px";
    }
}

/* Dragging */
const dragHandle = document.getElementById("drag-handle");
dragHandle.addEventListener("pointerdown", e=>{
    isDragging=true;
    offsetX = e.clientX - floating.offsetLeft;
    offsetY = e.clientY - floating.offsetTop;
    dragHandle.setPointerCapture(e.pointerId);
});

dragHandle.addEventListener("pointermove", e=>{
    if(isDragging){
        floating.style.left = (e.clientX - offsetX) + "px";
        floating.style.top = (e.clientY - offsetY) + "px";
        floating.style.bottom = "auto";
    }
});

dragHandle.addEventListener("pointerup", e=>{
    if(isDragging){
        isDragging=false;
        savePosition();
    }
});

/* Save position */
function savePosition(){
    savedPos.left = floating.offsetLeft;
    savedPos.bottom = window.innerHeight - (floating.offsetTop + floating.offsetHeight);
    localStorage.setItem("playerPos", JSON.stringify(savedPos));
}

/* Swipe down to minimize */
dragHandle.addEventListener("pointerup", e=>{
    let diff = e.clientY - startY;
    let time = Date.now() - swipeStartTime;
    if(diff > 80 && time < 300){
        minimizeFloating();
    }
});

function minimizeFloating(){
    floating.style.display="none";
}

/* Control buttons */
function togglePlay(){
    let state = player.getPlayerState();
    if(state == 1){
        player.pauseVideo();
    } else {
        player.playVideo();
    }
}

document.getElementById("stop-btn").onclick = ()=>{
    player.stopVideo();
};

document.getElementById("next-btn").onclick = ()=>{
    player.loadVideoById("3tmd-ClpJxA");
};
</script>

</body>
</html>
