<!doctype html>
<html lang="sr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Test: iframe.src autoplay (no JS API)</title>
<style>
  body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#111;color:#eee}
  .wrap{max-width:900px;margin:18px auto;padding:12px}
  .media-slider{width:100%;height:280px;overflow:hidden;position:relative;border-radius:12px;background:#000;display:flex}
  .panel{flex:0 0 50%;display:flex;align-items:center;justify-content:center;padding:12px;box-sizing:border-box}
  .panel.image{background:#111}
  .panel.video{background:#000}
  .video-wrap{width:100%;max-width:640px;aspect-ratio:16/9;border-radius:10px;overflow:hidden;background:#000;display:flex;align-items:center;justify-content:center}
  .video-wrap iframe{width:100%;height:100%;border:0;display:block}
  .controls{margin-top:14px;display:flex;gap:10px;align-items:center}
  .btn{padding:12px 18px;border-radius:10px;border:0;background:#6b8e23;color:#fff;font-weight:700;cursor:pointer}
  .btn.gray{background:#666}
  .thumbs{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
  .thumb{width:120px;height:68px;border-radius:6px;overflow:hidden;cursor:pointer;border:2px solid transparent}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .thumb.active{border-color:#6b8e23}
  .hint{margin-top:10px;color:#ccc;font-size:13px}
</style>
</head>
<body>
  <div class="wrap">
    <h2>Test: autoplay postavljanjem iframe.src (bez IFrame API)</h2>

    <div id="mediaWrap" class="media-slider" aria-hidden="false">
      <!-- image panel -->
      <div id="imagePanel" class="panel image">
        <div>
          <div style="font-size:18px;margin-bottom:8px">Izaberi video:</div>
          <div class="thumbs" id="thumbs"></div>
        </div>
      </div>

      <!-- video panel -->
      <div id="videoPanel" class="panel video">
        <div class="video-wrap">
          <!-- iframe bez enablejsapi -->
          <iframe id="ytPlayer" src="" allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen></iframe>
        </div>
      </div>
    </div>

    <div class="controls">
      <button id="playBtn" class="btn">▶ PLAY (postavi src & autoplay)</button>
      <button id="showVideoBtn" class="btn gray">Prikaži video panel</button>
      <button id="hideVideoBtn" class="btn gray">Prikaži sliku</button>
    </div>

    <div class="hint">
      Test: izaberi thumbnail, pa pritisni PLAY. Ako Via Browser blokira autoplay, pokušaj isto u Chrome-u.  
      Napomena: **važno** — PLAY mora da bude *direktan* klik (bez setTimeout/async) da bi šansa za autoplay bila veća.
    </div>
  </div>

<script>
(function(){
  // sample video URL-evi (možeš ih menjati)
  const videos = [
    'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
    'https://www.youtube.com/watch?v=3tmd-ClpJxA',
    'https://www.youtube.com/watch?v=kJQP7kiw5Fk',
    'https://www.youtube.com/watch?v=fRh_vgS2dFE'
  ];

  const thumbsEl = document.getElementById('thumbs');
  const ytIframe = document.getElementById('ytPlayer');
  const playBtn = document.getElementById('playBtn');
  const showVideoBtn = document.getElementById('showVideoBtn');
  const hideVideoBtn = document.getElementById('hideVideoBtn');
  const mediaWrap = document.getElementById('mediaWrap');
  const imagePanel = document.getElementById('imagePanel');
  const videoPanel = document.getElementById('videoPanel');

  let currentVideoUrl = videos[0];

  // helper: ekstra mali get ID
  function extractYouTubeId(url){
    if(!url) return null;
    let m = url.match(/[?&]v=([^&]+)/);
    if(m) return m[1];
    m = url.match(/youtu\.be\/([^?&]+)/);
    if(m) return m[1];
    try { const p = new URL(url).pathname.split('/').filter(Boolean); return p.length ? p.pop() : null; } catch(e) {}
    return null;
  }

  // populate thumbnails
  videos.forEach((u, idx) => {
    const id = extractYouTubeId(u);
    const div = document.createElement('div');
    div.className = 'thumb' + (idx===0 ? ' active' : '');
    div.dataset.url = u;
    div.innerHTML = `<img src="https://i.ytimg.com/vi/${id}/hqdefault.jpg" alt="thumb">`;
    div.addEventListener('click', function(){
      // izbaci aktivnu klasu
      document.querySelectorAll('.thumb').forEach(t=>t.classList.remove('active'));
      div.classList.add('active');
      currentVideoUrl = u;
    });
    thumbsEl.appendChild(div);
  });

  // funkcija koja postavlja src direktno sa autoplay=1 (bez enablejsapi)
  function showEmbeddedYoutube(url) {
    const id = extractYouTubeId(url);
    if(!id) return;
    // ako već isti id, ne radimo ništa (sprečava reload)
    if (ytIframe.dataset.videoId === id) return;

    // koristimo origin zbog CORS/AUTOPLAY scenarija (može biti window.location.origin)
    const origin = window.location.origin || 'https://example.com';
    const embed = 'https://www.youtube-nocookie.com/embed/' + id +
      '?autoplay=1' +
      '&playsinline=1' +
      '&rel=0' +
      '&modestbranding=1' +
      '&iv_load_policy=3' +
      '&controls=1';

    // VAŽNO: direktno dodeljujemo src u istom click handleru (bez setTimeout)
    ytIframe.src = embed;
    ytIframe.dataset.videoId = id;
  }

  function setPanelToVideo(){
    // jednostavan switch (translateX)
    mediaWrap.style.transform = 'translateX(-50%)';
    mediaWrap.style.transition = 'transform 300ms ease';
  }

  function setPanelToImage(){
    mediaWrap.style.transform = 'translateX(0%)';
    mediaWrap.style.transition = 'transform 300ms ease';
  }

  // play button: DIREKTNO pozivaj showEmbeddedYoutube u click handleru
  playBtn.addEventListener('click', function(){
    // *direktan* poziv — NIŠTA asinhrono pre toga
    showEmbeddedYoutube(currentVideoUrl);
    // opciono odmah prikazemo video panel — time se može izgubiti gesture u nekim browserima
    // ako primetiš da prilikom prikaza panel animation autoplay biva blokiran, probaj da komentarišeš ovu liniju
    setPanelToVideo();
  }, false);

  // opcije za ručno prikaz/skrivanje panela
  showVideoBtn.addEventListener('click', function(){ setPanelToVideo(); }, false);
  hideVideoBtn.addEventListener('click', function(){ setPanelToImage(); }, false);

  // init: postavimo širinu mediaWrap da bude 200% (2 panela) i inline style za animaciju
  mediaWrap.style.width = '200%';
  // pojedinačni paneli su po 50% (CSS flex)
  mediaWrap.style.transform = 'translateX(0%)';
})();
</script>
</body>
</html>
