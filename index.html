<!doctype html>
<html lang="sr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Autoplay muted + Tap to unmute (workaround)</title>
<style>
  :root{--bg:#0f0f10;--muted:#cfcfcf;--accent:#6b8e23}
  body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:#fff;display:flex;align-items:center;justify-content:center;height:100vh}
  .player-wrap{width:94%;max-width:900px;position:relative;border-radius:12px;overflow:hidden;box-shadow:0 12px 40px rgba(0,0,0,0.6)}
  .video-iframe{display:block;width:100%;height:56.25vw;max-height:506px;border:0;background:#000}
  /* Overlay */
  .overlay{
    position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
    background:linear-gradient(180deg, rgba(0,0,0,0.24), rgba(0,0,0,0.42));
    z-index:30;touch-action:none;
  }
  .overlay.hidden{display:none}
  .unmute-btn{
    display:flex;flex-direction:column;align-items:center;gap:10px;padding:18px 22px;border-radius:12px;
    background:rgba(0,0,0,0.6);backdrop-filter: blur(4px);cursor:pointer;border:2px solid rgba(255,255,255,0.06);
  }
  .icon {
    width:72px;height:72px;border-radius:50%;display:flex;align-items:center;justify-content:center;
    background:linear-gradient(135deg,var(--accent),#94b64b);font-size:36px;font-weight:700;color:#062;
    box-shadow:0 8px 20px rgba(0,0,0,0.5);
  }
  .lbl{font-size:16px;color:var(--muted);text-align:center;max-width:260px}
  .hint{font-size:13px;color:var(--muted);text-align:center;margin-top:8px}
  .small-actions{position:absolute;right:12px;bottom:12px;z-index:40;display:flex;gap:8px}
  .btn{padding:8px 12px;border-radius:8px;border:0;background:rgba(0,0,0,0.6);color:#fff;cursor:pointer}
  .btn.alt{background:rgba(255,255,255,0.06)}
  @media (max-width:560px){
    .icon{width:56px;height:56px;font-size:28px}
    .lbl{font-size:14px}
  }
</style>
</head>
<body>

<div class="player-wrap" id="playerWrap">
  <!-- iframe koristi enablejsapi da bismo mogli poslati postMessage naredbe za unMute -->
  <iframe id="ytIframe" class="video-iframe"
    src=""
    allow="autoplay; encrypted-media; picture-in-picture"
    allowfullscreen
    referrerpolicy="no-referrer"
  ></iframe>

  <div class="overlay" id="overlay">
    <div class="unmute-btn" id="unmuteBtn" role="button" aria-label="Tap to unmute" tabindex="0">
      <div class="icon">üîä</div>
      <div class="lbl"><strong>Tap to unmute</strong><br><span style="font-weight:400">Dodirni da ukloni≈° mute i pusti≈° zvuk</span></div>
      <div class="hint">Ako ni≈°ta ne radi, koristi "Open in YouTube".</div>
    </div>
  </div>

  <div class="small-actions" id="actions">
    <button class="btn alt" id="openBtn">Open in YouTube</button>
    <button class="btn alt" id="hideOverlayBtn">Sakrij poruku</button>
  </div>
</div>

<script>
(function(){
  // menja≈° ovde video URL (ili dinamicko iz UI)
  const videoUrl = 'https://www.youtube.com/watch?v=dQw4w9WgXcQ'; // staviti svoj URL/ID
  // EXTRACT ID helper
  function extractId(u){
    if(!u) return null;
    const m = u.match(/[?&]v=([^&]+)/); if(m) return m[1];
    const m2 = u.match(/youtu\.be\/([^?&]+)/); if(m2) return m2[1];
    try{ const p=new URL(u).pathname.split('/').filter(Boolean); return p.length? p.pop(): null; }catch(e){ return null; }
  }

  const id = extractId(videoUrl);
  if(!id){ console.warn('No video id'); return; }

  const iframe = document.getElementById('ytIframe');
  const overlay = document.getElementById('overlay');
  const unmuteBtn = document.getElementById('unmuteBtn');
  const openBtn = document.getElementById('openBtn');
  const hideOverlayBtn = document.getElementById('hideOverlayBtn');

  // 1) Postavi src sa autoplay=1 *i* mute=1 -> pokrenuƒáe video, ali uti≈°ano (ovo browseri dopu≈°taju)
  // koristimo nocookie varijantu i enablejsapi=1 da bismo kasnije mogli poslati unMute komandu iz korisniƒçke geste
  const src = 'https://www.youtube-nocookie.com/embed/' + id +
              '?autoplay=1&mute=1&playsinline=1&rel=0&modestbranding=1&iv_load_policy=3&controls=1&enablejsapi=1';
  iframe.src = src;

  // helper za slanje postMessage naredbi youtu-be playeru
  function postMessageToPlayer(func, args){
    if(!iframe || !iframe.contentWindow) return;
    try{
      iframe.contentWindow.postMessage(JSON.stringify({
        event: 'command',
        func: func,
        args: args || []
      }), 'https://www.youtube.com'); // ili https://www.youtube-nocookie.com
      // takoƒëe poku≈°aj drugi origin (ponekad)
      iframe.contentWindow.postMessage(JSON.stringify({
        event: 'command',
        func: func,
        args: args || []
      }), 'https://www.youtube-nocookie.com');
    }catch(e){
      // ignore
    }
  }

  // Flag da bismo znali da li smo poku≈°ali unmute
  let attemptedUnmute = false;

  // Funkcija koja se poziva u USER GESTURE (click/touch) da ukloni mute
  function doUnmuteFromGesture(e){
    // prvo prevent default da bismo bili sigurni da gesture ostane validna
    if(e && e.preventDefault) e.preventDefault();

    if(attemptedUnmute) {
      // veƒá poku≈°ali, samo sakrij overlay
      overlay.classList.add('hidden');
      return;
    }

    attemptedUnmute = true;

    // 1) po≈°alji unMute komandu
    postMessageToPlayer('unMute');

    // 2) po≈°alji playVideo da bude sigurno (ako je potrebno)
    postMessageToPlayer('playVideo');

    // 3) ukloni overlay - korisnik vidi video i ƒçuje zvuk ako WebView dozvoljava
    overlay.classList.add('hidden');

    // 4) nakon malo vremena proveri (fallback): ako nema zvuka, poka≈æi fallback instrukciju
    setTimeout(()=> {
      // nemamo reliable API za proveru audio u WebView, pa samo ako overlay je skriven -> OK
      // ako ≈æeli≈°, mo≈æe≈° pokazati notifikaciju da korisnik treba da odmutira ruƒçno
    }, 600);
  }

  // Ve≈æemo oba eventa ‚Äî click i touchend (mobilni)
  unmuteBtn.addEventListener('click', doUnmuteFromGesture, {passive:false});
  unmuteBtn.addEventListener('touchend', doUnmuteFromGesture, {passive:false});

  // Open in YouTube fallback (otvori u novom tabu)
  openBtn.addEventListener('click', function(){
    window.open('https://www.youtube.com/watch?v=' + id, '_blank');
  });

  // Sakrij overlay ali ostavi instr
  hideOverlayBtn.addEventListener('click', function(){
    overlay.classList.add('hidden');
  });

  // Ako ≈æeli≈°, overlay mo≈æe blago blinkati/animirati da privuƒçe pa≈ænju
})();
</script>

</body>
</html>
